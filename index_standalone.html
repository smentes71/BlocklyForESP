<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP32 Blok Programlama</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .workspace {
            display: flex;
            min-height: 600px;
        }
        
        .toolbox {
            width: 300px;
            background: #f8f9fa;
            border-right: 1px solid #dee2e6;
            padding: 20px;
            overflow-y: auto;
        }
        
        .canvas {
            flex: 1;
            padding: 20px;
            background: #ffffff;
            position: relative;
        }
        
        .category {
            margin-bottom: 20px;
        }
        
        .category-title {
            font-weight: bold;
            color: #495057;
            margin-bottom: 10px;
            padding: 8px 12px;
            background: #e9ecef;
            border-radius: 5px;
            cursor: pointer;
            user-select: none;
        }
        
        .category-title:hover {
            background: #dee2e6;
        }
        
        .blocks {
            display: none;
            padding-left: 10px;
        }
        
        .blocks.active {
            display: block;
        }
        
        .block {
            background: #007bff;
            color: white;
            padding: 10px 15px;
            margin: 5px 0;
            border-radius: 5px;
            cursor: grab;
            user-select: none;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        
        .block:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .block:active {
            cursor: grabbing;
        }
        
        /* Kategori renkleri */
        .category-basic .block { background: #28a745; }
        .category-basic .block:hover { background: #1e7e34; }
        
        .category-sensors .block { background: #ffc107; color: #212529; }
        .category-sensors .block:hover { background: #e0a800; }
        
        .category-actuators .block { background: #dc3545; }
        .category-actuators .block:hover { background: #c82333; }
        
        .category-communication .block { background: #6f42c1; }
        .category-communication .block:hover { background: #5a32a3; }
        
        .category-touch .block { background: #fd7e14; }
        .category-touch .block:hover { background: #e8590c; }
        
        .dropped-block {
            position: absolute;
            background: #007bff;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: move;
            user-select: none;
            border: 2px solid #0056b3;
            min-width: 120px;
            text-align: center;
        }
        
        .canvas-grid {
            background-image: 
                linear-gradient(rgba(0,0,0,.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,0,0,.1) 1px, transparent 1px);
            background-size: 20px 20px;
            min-height: 100%;
        }
        
        .controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
        }
        
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 0 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn:hover {
            background: #0056b3;
        }
        
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #1e7e34; }
        
        .btn-danger { background: #dc3545; }
        .btn-danger:hover { background: #c82333; }
        
        .code-output {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border: 2px solid #007bff;
            border-radius: 10px;
            padding: 20px;
            max-width: 80%;
            max-height: 80%;
            overflow: auto;
            z-index: 2000;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .code-output pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 10px 0;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1500;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ESP32 Blok Programlama Edit√∂r√º</h1>
            <p>S√ºr√ºkle-bƒ±rak ile ESP32 kodlarƒ± olu≈üturun</p>
        </div>
        
        <div class="workspace">
            <div class="toolbox">
                <div class="category category-basic">
                    <div class="category-title" onclick="toggleCategory(this)">üìã Temel Bloklar</div>
                    <div class="blocks">
                        <div class="block" draggable="true">Setup</div>
                        <div class="block" draggable="true">Loop</div>
                        <div class="block" draggable="true">Delay</div>
                        <div class="block" draggable="true">If/Else</div>
                        <div class="block" draggable="true">While</div>
                        <div class="block" draggable="true">For</div>
                        <div class="block" draggable="true">Variable</div>
                        <div class="block" draggable="true">Function</div>
                    </div>
                </div>
                
                <div class="category category-sensors">
                    <div class="category-title" onclick="toggleCategory(this)">üîç Sens√∂rler</div>
                    <div class="blocks">
                        <div class="block" draggable="true">DHT22 Sƒ±caklƒ±k</div>
                        <div class="block" draggable="true">DHT22 Nem</div>
                        <div class="block" draggable="true">Ultrasonic Mesafe</div>
                        <div class="block" draggable="true">LDR I≈üƒ±k</div>
                        <div class="block" draggable="true">PIR Hareket</div>
                        <div class="block" draggable="true">Analog Okuma</div>
                        <div class="block" draggable="true">Digital Okuma</div>
                    </div>
                </div>
                
                <div class="category category-actuators">
                    <div class="category-title" onclick="toggleCategory(this)">‚ö° Akt√ºat√∂rler</div>
                    <div class="blocks">
                        <div class="block" draggable="true">LED Yak</div>
                        <div class="block" draggable="true">LED S√∂nd√ºr</div>
                        <div class="block" draggable="true">Servo Motor</div>
                        <div class="block" draggable="true">DC Motor</div>
                        <div class="block" draggable="true">Buzzer</div>
                        <div class="block" draggable="true">Digital Yazma</div>
                        <div class="block" draggable="true">Analog Yazma (PWM)</div>
                    </div>
                </div>
                
                <div class="category category-communication">
                    <div class="category-title" onclick="toggleCategory(this)">üì° ƒ∞leti≈üim</div>
                    <div class="blocks">
                        <div class="block" draggable="true">Serial Print</div>
                        <div class="block" draggable="true">WiFi Baƒülan</div>
                        <div class="block" draggable="true">HTTP GET</div>
                        <div class="block" draggable="true">HTTP POST</div>
                        <div class="block" draggable="true">MQTT Publish</div>
                        <div class="block" draggable="true">MQTT Subscribe</div>
                        <div class="block" draggable="true">Bluetooth Send</div>
                    </div>
                </div>
                
                <div class="category category-touch">
                    <div class="category-title" onclick="toggleCategory(this)">üëÜ Dokunma, Titre≈üim ve Butonlar</div>
                    <div class="blocks">
                        <div class="block" draggable="true">TTP223 Kapasitif Dokunmatik</div>
                        <div class="block" draggable="true">Piezo Titre≈üim Sens√∂r√º</div>
                        <div class="block" draggable="true">SW-420 Titre≈üim Sens√∂r√º</div>
                        <div class="block" draggable="true">Tilt Sens√∂r√º (Eƒüilme)</div>
                        <div class="block" draggable="true">IR Alƒ±cƒ± (IR Receiver)</div>
                        <div class="block" draggable="true">Push Button</div>
                        <div class="block" draggable="true">Toggle Switch</div>
                        <div class="block" draggable="true">Rotary Encoder</div>
                    </div>
                </div>
            </div>
            
            <div class="canvas">
                <div class="controls">
                    <button class="btn btn-success" onclick="generateCode()">üîß Kod √úret</button>
                    <button class="btn btn-danger" onclick="clearCanvas()">üóëÔ∏è Temizle</button>
                    <button class="btn" onclick="saveProject()">üíæ Kaydet</button>
                    <button class="btn" onclick="loadProject()">üìÅ Y√ºkle</button>
                </div>
                <div class="canvas-grid" id="canvas"></div>
            </div>
        </div>
    </div>
    
    <div class="overlay" id="overlay" onclick="closeCodeOutput()"></div>
    <div class="code-output" id="codeOutput">
        <h3>√úretilen Arduino Kodu</h3>
        <button class="btn" style="float: right;" onclick="closeCodeOutput()">‚úñ Kapat</button>
        <button class="btn btn-success" style="float: right; margin-right: 10px;" onclick="copyCode()">üìã Kopyala</button>
        <pre id="generatedCode"></pre>
    </div>

    <script>
        let draggedElement = null;
        let droppedBlocks = [];
        let blockCounter = 0;

        // Kategori a√ßma/kapama
        function toggleCategory(element) {
            const blocks = element.nextElementSibling;
            blocks.classList.toggle('active');
        }

        // T√ºm kategorileri a√ß
        document.addEventListener('DOMContentLoaded', function() {
            const categories = document.querySelectorAll('.category-title');
            categories.forEach(category => {
                category.nextElementSibling.classList.add('active');
            });
        });

        // Drag and Drop i≈ülemleri
        document.addEventListener('dragstart', function(e) {
            if (e.target.classList.contains('block')) {
                draggedElement = e.target;
                e.dataTransfer.effectAllowed = 'copy';
            }
        });

        document.addEventListener('dragover', function(e) {
            if (e.target.id === 'canvas' || e.target.classList.contains('canvas-grid')) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'copy';
            }
        });

        document.addEventListener('drop', function(e) {
            if ((e.target.id === 'canvas' || e.target.classList.contains('canvas-grid')) && draggedElement) {
                e.preventDefault();
                
                const rect = e.target.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                createDroppedBlock(draggedElement.textContent, x, y);
                draggedElement = null;
            }
        });

        function createDroppedBlock(text, x, y) {
            const canvas = document.getElementById('canvas');
            const block = document.createElement('div');
            block.className = 'dropped-block';
            block.textContent = text;
            block.style.left = x + 'px';
            block.style.top = y + 'px';
            block.id = 'block_' + (++blockCounter);
            
            // Blok hareket ettirme
            let isDragging = false;
            let startX, startY, initialX, initialY;
            
            block.addEventListener('mousedown', function(e) {
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                initialX = parseInt(block.style.left);
                initialY = parseInt(block.style.top);
                block.style.zIndex = 1000;
            });
            
            document.addEventListener('mousemove', function(e) {
                if (isDragging && block) {
                    const dx = e.clientX - startX;
                    const dy = e.clientY - startY;
                    block.style.left = (initialX + dx) + 'px';
                    block.style.top = (initialY + dy) + 'px';
                }
            });
            
            document.addEventListener('mouseup', function() {
                if (isDragging) {
                    isDragging = false;
                    block.style.zIndex = 'auto';
                }
            });
            
            // √áift tƒ±klama ile silme
            block.addEventListener('dblclick', function() {
                if (confirm('Bu bloƒüu silmek istediƒüinizden emin misiniz?')) {
                    canvas.removeChild(block);
                    droppedBlocks = droppedBlocks.filter(b => b.id !== block.id);
                }
            });
            
            canvas.appendChild(block);
            droppedBlocks.push({
                id: block.id,
                type: text,
                x: x,
                y: y,
                element: block
            });
        }

        function clearCanvas() {
            if (confirm('T√ºm bloklarƒ± silmek istediƒüinizden emin misiniz?')) {
                const canvas = document.getElementById('canvas');
                const blocks = canvas.querySelectorAll('.dropped-block');
                blocks.forEach(block => canvas.removeChild(block));
                droppedBlocks = [];
                blockCounter = 0;
            }
        }

        function generateCode() {
            let code = generateArduinoCode();
            document.getElementById('generatedCode').textContent = code;
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('codeOutput').style.display = 'block';
        }

        function generateArduinoCode() {
            let setupCode = '';
            let loopCode = '';
            let includeCode = '';
            let variableCode = '';
            
            // Pin tanƒ±mlamalarƒ±
            let pinDefinitions = '';
            
            droppedBlocks.forEach(block => {
                switch(block.type) {
                    case 'TTP223 Kapasitif Dokunmatik':
                        pinDefinitions += '#define TOUCH_PIN 2\n';
                        setupCode += '  pinMode(TOUCH_PIN, INPUT);\n';
                        loopCode += '  if (digitalRead(TOUCH_PIN) == HIGH) {\n    Serial.println("Dokunma algƒ±landƒ±!");\n  }\n';
                        break;
                        
                    case 'Piezo Titre≈üim Sens√∂r√º':
                        pinDefinitions += '#define PIEZO_PIN A0\n';
                        setupCode += '  pinMode(PIEZO_PIN, INPUT);\n';
                        loopCode += '  int piezoValue = analogRead(PIEZO_PIN);\n  if (piezoValue > 100) {\n    Serial.println("Titre≈üim algƒ±landƒ±: " + String(piezoValue));\n  }\n';
                        break;
                        
                    case 'SW-420 Titre≈üim Sens√∂r√º':
                        pinDefinitions += '#define VIBRATION_PIN 3\n';
                        setupCode += '  pinMode(VIBRATION_PIN, INPUT);\n';
                        loopCode += '  if (digitalRead(VIBRATION_PIN) == HIGH) {\n    Serial.println("SW-420 Titre≈üim algƒ±landƒ±!");\n  }\n';
                        break;
                        
                    case 'Tilt Sens√∂r√º (Eƒüilme)':
                        pinDefinitions += '#define TILT_PIN 4\n';
                        setupCode += '  pinMode(TILT_PIN, INPUT_PULLUP);\n';
                        loopCode += '  if (digitalRead(TILT_PIN) == LOW) {\n    Serial.println("Eƒüilme algƒ±landƒ±!");\n  }\n';
                        break;
                        
                    case 'IR Alƒ±cƒ± (IR Receiver)':
                        includeCode += '#include <IRremote.h>\n';
                        pinDefinitions += '#define IR_RECEIVE_PIN 11\n';
                        setupCode += '  IrReceiver.begin(IR_RECEIVE_PIN, ENABLE_LED_FEEDBACK);\n';
                        loopCode += '  if (IrReceiver.decode()) {\n    Serial.println("IR Kod: 0x" + String(IrReceiver.decodedIRData.decodedRawData, HEX));\n    IrReceiver.resume();\n  }\n';
                        break;
                        
                    case 'Push Button':
                        pinDefinitions += '#define BUTTON_PIN 5\n';
                        setupCode += '  pinMode(BUTTON_PIN, INPUT_PULLUP);\n';
                        loopCode += '  if (digitalRead(BUTTON_PIN) == LOW) {\n    Serial.println("Buton basƒ±ldƒ±!");\n    delay(200); // Debounce\n  }\n';
                        break;
                        
                    case 'Toggle Switch':
                        pinDefinitions += '#define SWITCH_PIN 6\n';
                        setupCode += '  pinMode(SWITCH_PIN, INPUT_PULLUP);\n';
                        loopCode += '  if (digitalRead(SWITCH_PIN) == LOW) {\n    Serial.println("Switch ON");\n  } else {\n    Serial.println("Switch OFF");\n  }\n';
                        break;
                        
                    case 'Rotary Encoder':
                        pinDefinitions += '#define ENCODER_CLK 7\n#define ENCODER_DT 8\n#define ENCODER_SW 9\n';
                        variableCode += 'int encoderPos = 0;\nint lastCLK = HIGH;\n';
                        setupCode += '  pinMode(ENCODER_CLK, INPUT);\n  pinMode(ENCODER_DT, INPUT);\n  pinMode(ENCODER_SW, INPUT_PULLUP);\n';
                        loopCode += '  int currentCLK = digitalRead(ENCODER_CLK);\n  if (currentCLK != lastCLK && currentCLK == LOW) {\n    if (digitalRead(ENCODER_DT) == LOW) {\n      encoderPos++;\n    } else {\n      encoderPos--;\n    }\n    Serial.println("Encoder Position: " + String(encoderPos));\n  }\n  lastCLK = currentCLK;\n  \n  if (digitalRead(ENCODER_SW) == LOW) {\n    Serial.println("Encoder butonu basƒ±ldƒ±!");\n    delay(200);\n  }\n';
                        break;
                        
                    case 'LED Yak':
                        pinDefinitions += '#define LED_PIN 13\n';
                        setupCode += '  pinMode(LED_PIN, OUTPUT);\n';
                        loopCode += '  digitalWrite(LED_PIN, HIGH);\n';
                        break;
                        
                    case 'Serial Print':
                        setupCode += '  Serial.begin(115200);\n';
                        loopCode += '  Serial.println("Merhaba ESP32!");\n';
                        break;
                        
                    case 'Delay':
                        loopCode += '  delay(1000);\n';
                        break;
                }
            });
            
            let fullCode = includeCode + '\n' + 
                          pinDefinitions + '\n' + 
                          variableCode + '\n' +
                          'void setup() {\n' + 
                          setupCode + 
                          '}\n\n' +
                          'void loop() {\n' + 
                          loopCode + 
                          '}\n';
                          
            return fullCode;
        }

        function closeCodeOutput() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('codeOutput').style.display = 'none';
        }

        function copyCode() {
            const code = document.getElementById('generatedCode').textContent;
            navigator.clipboard.writeText(code).then(function() {
                alert('Kod panoya kopyalandƒ±!');
            });
        }

        function saveProject() {
            const projectData = {
                blocks: droppedBlocks.map(block => ({
                    type: block.type,
                    x: block.x,
                    y: block.y
                })),
                timestamp: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(projectData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'esp32_project.json';
            link.click();
        }

        function loadProject() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const projectData = JSON.parse(e.target.result);
                            clearCanvas();
                            
                            projectData.blocks.forEach(blockData => {
                                createDroppedBlock(blockData.type, blockData.x, blockData.y);
                            });
                            
                            alert('Proje ba≈üarƒ±yla y√ºklendi!');
                        } catch (error) {
                            alert('Proje dosyasƒ± okunamadƒ±: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
    </script>
</body>
</html>